<!DOCTYPE html>

<html>

<head>
  <title>CT</title>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

  <script type="text/javascript" src="lib/platform/platform.js"></script>

  <link rel="import" href="lib/font-roboto/roboto.html">
  <link rel="import" href="lib/core-header-panel/core-header-panel.html">
  <link rel="import" href="lib/core-toolbar/core-toolbar.html">
  <link rel="import" href="lib/core-animated-pages/core-animated-pages.html">
  <link rel="import" href="lib/core-drawer-panel/core-drawer-panel.html">
  <link rel="import" href="lib/core-item/core-item.html">
  <link rel="import" href="lib/core-menu/core-menu.html">

  <link rel="import" href="lib/paper-tabs/paper-tabs.html">
  <link rel="import" href="lib/paper-menu-button/paper-menu-button.html">
  <link rel="import" href="lib/paper-item/paper-item.html">
  <link rel="import" href="lib/flatiron-director/flatiron-director.html">

  <link rel="import" href="components/pages/ct-pages.html">
  <link rel="import" href="components/ct-controller.html">
  <link rel="import" href="services/ct-auth-service.html">
  <link rel="import" href="services/ct-msg-service.html">

  <link rel="stylesheet" type="text/css" href="css/main.css">
</head>

<body unresolved>

  <template is="auto-binding">

    <flatiron-director id="nav" route="{{route}}" autoHash
            on-director-route="{{routeChanged}}"></flatiron-director>

    <ct-auth-service id="auth"></ct-auth-service>
    <ct-msg-service user="{{user}}"></ct-msg-service>

    <core-drawer-panel>
      <core-header-panel drawer>
        <core-toolbar class="theme">
          <div class="title">Go Chat</div>
        </core-toolbar>
        <template if="{{user.logged}}">
            Hello {{user.identity.Username}}!
            <core-menu selected="{{route}}" valueattr="hash">
                <core-item label="Profile" on-tap="{{profile}}"></core-item>
                <core-item label="Settings"></core-item>
                <core-item label="Send Feedback"></core-item>
                <core-item label="Help"></core-item>
                <core-item label="Sign Out" on-tap="{{logout}}"></core-item>
            </core-menu>
          </template>
      </core-header-panel>
      <core-header-panel main>
        <core-toolbar class="theme">
          <paper-tabs id="tabsLeft" selected="{{route}}" valueattr="hash" self-end>
            <paper-tab hash="home">Home</paper-tab>
            <template if="{{user.logged}}">
              <paper-tab hash="chat">Chat</paper-tab>
            </template>
          </paper-tabs>
        </core-toolbar>

        <div class="container" vertical layout center-justified>
          <ct-controller id="controller" route="{{route}}" user="{{user}}">
            <ct-page-home name="home"></ct-page-home>
            <ct-page-chat name="chat"></ct-page-chat>
            <ct-page-register name="register"></ct-page-register>
            <ct-page-login name="login"></ct-page-login>
            <ct-page-profile name="profile" model></ct-page-profile>
          </ct-controller>
        </div>
      </core-header-panel>
    </core-drawer-panel>
  </template>

<script type="text/javascript">
  var template = document.querySelector('template');

  template.addEventListener('template-bound', function() {
    this.route = this.route || 'home';
    this.user = this.$.auth.user;
    this.$.controller.nav = this.$.nav;
    this.$.controller.init();

  });

  template.routeChanged = function() {
    if(this.route) {
      document.title = "CT - " + this.route;
    }
  }

  template.logout = function() {
    this.$.auth.logout();
    this.route = 'home';
  }

  template.profile = function() {
    this.route = 'profile';
  }

  

</script>

</body>

</html>