<!DOCTYPE html>

<html>

<head>
  <title>CT</title>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

  <script type="text/javascript" src="lib/platform/platform.js"></script>

  <link rel="import" href="lib/font-roboto/roboto.html">
  <link rel="import" href="lib/core-header-panel/core-header-panel.html">
  <link rel="import" href="lib/core-toolbar/core-toolbar.html">
  <link rel="import" href="lib/core-animated-pages/core-animated-pages.html">

  <link rel="import" href="lib/paper-tabs/paper-tabs.html">
  <link rel="import" href="lib/paper-menu-button/paper-menu-button.html">
  <link rel="import" href="lib/paper-item/paper-item.html">
  <link rel="import" href="lib/flatiron-director/flatiron-director.html">

  <link rel="import" href="components/pages/ct-pages.html">
  <link rel="import" href="components/ct-controller.html">
  <link rel="import" href="services/ct-auth-service.html">
  <link rel="import" href="services/ct-msg-service.html">

  <link rel="stylesheet" type="text/css" href="css/main.css"></head>

  <style>
    #tabsLeft {
      max-width: 400px;
    }
    #tabsRight {
      max-width: 400px;
    }
    #controlsRight {
      height: 48px;
      font-size: 14px;
      font-weight: 500;
    }
    #controlsRight paper-button {
      margin-left: 20px;
    }
    paper-item {
      color: #000;
    }
    paper-menu-button {
      margin-left: 50px;
      margin-rigth: 30px;
    }
  </style>

<body unresolved>

  <template is="auto-binding">

    <flatiron-director id="nav" route="{{route}}" autoHash
            on-director-route="{{routeChanged}}"></flatiron-director>

    <ct-auth-service id="auth"></ct-auth-service>
    <ct-msg-service user="{{user}}"></ct-msg-service>

    <core-header-panel>
      <core-toolbar>
        <paper-tabs id="tabsLeft" selected="{{route}}" valueattr="hash" self-end flex>
          <paper-tab hash="home">Home</paper-tab>
          <template if="{{user.logged}}">
            <paper-tab hash="chat">Chat</paper-tab>
          </template>
        </paper-tabs>
        <div flex></div>
        <paper-tabs id="tabsRight" selected="{{route}}" valueattr="hash" self-end flex>
          <template if="{{!user.logged}}">
            <paper-tab hash="login">Login</paper-tab>
            <paper-tab hash="register">Register</paper-tab>
          </template>
        </paper-tabs>
        <template if="{{user.logged}}">
          <div id="controlsRight" horizontal layout center self-end>
              Hello {{user.identity.Username}}!
              <paper-menu-button icon="more-vert" halign="right">
                <paper-item label="Profile" on-tap="{{profile}}"></paper-item>
                <paper-item label="Settings"></paper-item>
                <paper-item label="Send Feedback"></paper-item>
                <paper-item label="Help"></paper-item>
                <paper-item label="Sign Out" on-tap="{{logout}}"></paper-item>
              </paper-menu-button>
          </div>
        </template>
      </core-toolbar>
      <div class="container" vertical layout center-justified>
        <ct-controller id="controller" route="{{route}}" user="{{user}}">
          <ct-page-home name="home"></ct-page-home>
          <ct-page-chat name="chat"></ct-page-chat>
          <ct-page-register name="register"></ct-page-register>
          <ct-page-login name="login"></ct-page-login>
          <ct-page-profile name="profile" model></ct-page-profile>
        </ct-controller>
      </div>
    </core-header-panel>

  </template>

<script type="text/javascript">
  var template = document.querySelector('template');

  template.addEventListener('template-bound', function() {
    this.route = this.route || 'home';
    this.user = this.$.auth.user;
    this.$.controller.nav = this.$.nav;
    this.$.controller.init();

  });

  template.routeChanged = function() {
    if(this.route) {
      document.title = "CT - " + this.route;
    }
  }

  template.logout = function() {
    this.$.auth.logout();
    this.route = 'home';
  }

  template.profile = function() {
    this.route = 'profile';
  }

  

</script>

</body>

</html>