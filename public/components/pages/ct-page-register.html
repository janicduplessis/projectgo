<link rel="import" href="/lib/paper-input/paper-input.html">
<link rel="import" href="/lib/paper-button/paper-button.html">

<link rel="import" href="/services/ct-auth-service.html">
<link rel="import" href="/components/ct-module.html">

<polymer-element name="ct-page-register" extends="ct-module">
	<template>
		<style>
    		.primary {
    			color: #fff;
    			background-color: #03a9f4;
    		}
    		paper-input {
    			width: 100%;
    		}
    		paper-button {
    			margin-left: 10px;
    		}
    	</style>

    	<ct-auth-service id="authService" on-ct-register="{{register}}"></ct-auth-service>

    	<h2>Register</h2>
        <div on-keypress="{{onKeypress}}">
    		<paper-input id="username" label="Username" error="Username must be at least 6 charaters long." maxlength="40" value="{{username}}" flex></paper-input>
    		<paper-input id="password" label="Password" error="Password must be at least 6 charaters long." maxlength="40" type="password" value="{{password}}"></paper-input>
    		<paper-input id="passwordRepeat" label="Repeat password" error="Passwords don't match." maxlength="40" type="password" value="{{passwordRepeat}}"></paper-input>
    		<paper-input id="firstName" label="First name" error="Please enter your first name." maxlength="40" value="{{firstName}}"></paper-input>
    		<paper-input id="lastName" label="Last name" error="Please enter your last name." maxlength="40" value="{{lastName}}"></paper-input>
    		<paper-input id="email" label="Email" type="email" maxlength="40" value="{{email}}"></paper-input>
    		<div flex horizontal end-justified layout>
    			<paper-button raisedButton class="primary" label="Submit" on-tap="{{submit}}"></paper-button>
    		</div>
        </div>
  	</template>
  	<script>
		Polymer('ct-page-register', {
		  	submit: function() {
                //validate fields
                var invalid = false;

                this.$.username.invalid = false;
                this.$.password.invalid = false;
                this.$.passwordRepeat.invalid = false;
                this.$.firstName.invalid = false;
                this.$.lastName.invalid = false;

                if(this.username.length < 6) {
                    this.$.username.invalid = true;
                    invalid = true;
                }

                if(this.password.length < 6) {
                    this.$.password.invalid = true;
                    invalid = true;
                }

                if(this.passwordRepeat.length < 1) {
                    this.$.passwordRepeat.invalid = true;
                    invalid = true;
                }

                if(this.firstName.length < 1) {
                    this.$.firstName.invalid = true;
                    invalid = true;
                }

                if(this.lastName.length < 1) {
                    this.$.lastName.invalid = true;
                    invalid = true;
                }

                if(this.email.length < 1) {
                    this.$.email.invalid = true;
                    invalid = true;
                }

                if(this.password !== this.passwordRepeat) {
                    this.$.passwordRepeat.invalid = true;
                    invalid = true;
                }

                if(!invalid) {
		  		  this.$.authService.register(this.username, this.password, this.firstName, this.lastName, this.email);
                }
		  	},
		    register: function(event) {
                this.querySelector('paper-input');
		    	var response = event.detail;
		    	if(response.result) {
		    		this.nav.route = 'home'
                    this.$.username.invalid = false;
                    this.$.password.invalid = false;
                    this.$.passwordRepeat.invalid = false;
                    this.$.firstName.invalid = false;
                    this.$.lastName.invalid = false;
                    this.$.email.invalid = false;
                    this.$.username.value = '';
                    this.$.password.value = '';
                    this.$.passwordRepeat.value = '';
                    this.$.firstName.value = '';
                    this.$.lastName.value = '';
                    this.$.email.value = '';
		    	} else {
                    
		    	}
		    },
            onKeypress: function(event) {
                //Enter
                if(event.keyCode === 13) {
                    event.target.blur();
                    event.preventDefault();
                    this.submit();
                }
            }
		});
  	</script>
</polymer-element>
